import figures from '@roots/bud-support/figures';
import Ink from '@roots/bud-support/ink';
import Link from '@roots/bud-support/ink-link';
import { externalNetworkInterface } from '@roots/bud-support/os';
import React from '@roots/bud-support/react';
import { color } from '../format.js';
import useWatchedFilesCount from './useWatchedFilesCount.js';
/**
 * Server info ink component
 */
export const Server = ({ devUrl, publicDevUrl, displayServerInfo, watchFiles = new Set(), proxyUrl, publicProxyUrl, }) => {
    const hasMappedProxyUrl = publicProxyUrl?.origin && publicProxyUrl?.origin !== proxyUrl.origin;
    const hasMappedDevUrl = publicDevUrl.origin !== devUrl.origin;
    const ipv4 = externalNetworkInterface.ipv4Url(publicDevUrl.protocol);
    ipv4.port = publicDevUrl.port;
    const watchedFilesCount = useWatchedFilesCount(watchFiles);
    return (React.createElement(Ink.Box, { flexDirection: "column" },
        React.createElement(Ink.Box, { flexDirection: "row" },
            React.createElement(Ink.Text, { color: color.blue, dimColor: !displayServerInfo },
                figures.info,
                " ",
                React.createElement(Ink.Text, { underline: true }, "s"),
                "erver")),
        displayServerInfo ? (React.createElement(React.Fragment, null,
            React.createElement(Ink.Text, { dimColor: true }, figures.lineVerticalDashed7),
            hasMappedProxyUrl ? (React.createElement(React.Fragment, null,
                proxyUrl && (React.createElement(Value, { label: "proxy (internal)", value: proxyUrl.origin })),
                publicProxyUrl && (React.createElement(Value, { label: "proxy (external)", value: publicProxyUrl.origin })),
                React.createElement(Ink.Text, { dimColor: true }, figures.lineVertical))) : (React.createElement(React.Fragment, null,
                proxyUrl && React.createElement(Value, { label: "proxy", value: proxyUrl.origin }),
                React.createElement(Ink.Text, { dimColor: true }, figures.lineVertical))),
            hasMappedDevUrl ? (React.createElement(React.Fragment, null,
                devUrl && (React.createElement(Value, { label: "dev (internal)", value: devUrl.origin })),
                devUrl && (React.createElement(Value, { label: "dev (external)", value: publicDevUrl.origin })),
                React.createElement(Ink.Text, { dimColor: true }, figures.lineVertical))) : (React.createElement(React.Fragment, null,
                devUrl && React.createElement(Value, { label: "dev", value: devUrl.origin }),
                React.createElement(Ink.Text, { dimColor: true }, figures.lineVertical))),
            React.createElement(Value, { label: "ipv4", value: ipv4.origin, last: true }),
            React.createElement(Ink.Box, { marginTop: 1, minWidth: "100%", flexDirection: "row", justifyContent: "space-between" },
                React.createElement(Ink.Text, null,
                    figures.ellipsis,
                    " watching project sources",
                    watchedFilesCount > 0 && (React.createElement(Ink.Text, { dimColor: true },
                        ` `,
                        "(and ",
                        watchedFilesCount,
                        " other",
                        ` `,
                        watchedFilesCount > 1 ? `files` : `file`,
                        ")",
                        ` `))),
                React.createElement(Ink.Text, null,
                    figures.info,
                    " ",
                    React.createElement(Ink.Text, { dimColor: true }, "ctrl+c to exit"))))) : null));
};
const Value = ({ label, value, last, }) => (React.createElement(Ink.Box, { flexDirection: "row" },
    React.createElement(Ink.Box, { marginRight: 1 },
        React.createElement(Ink.Text, { dimColor: true },
            last ? `└─` : `├─`,
            " ",
            label,
            ":")),
    React.createElement(Ink.Box, null,
        React.createElement(Link, { url: value },
            React.createElement(Ink.Text, null, value)))));
//# sourceMappingURL=index.js.map