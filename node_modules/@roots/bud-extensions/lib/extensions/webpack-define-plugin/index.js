import { __decorate, __metadata } from "tslib";
import { Bud, Extension } from '@roots/bud-framework';
import { bind, label, plugin, } from '@roots/bud-framework/extension/decorators';
import isUndefined from '@roots/bud-support/lodash/isUndefined';
import Webpack from '@roots/bud-support/webpack';
/**
 * `@roots/bud-extensions/webpack-define-plugin` adapter
 *
 * @public
 * @decorator `@label`
 * @decorator `@plugin`
 */
let BudDefine = class BudDefine extends Extension {
    /**
     * `init` callback
     *
     * @public
     * @decorator `@bind`
     */
    async init({ env }) {
        if (!env.getPublicEnv())
            return;
        this.setOptions(Object.entries(env.getPublicEnv()).reduce((values, [key, value]) => ({
            ...values,
            [key]: JSON.stringify(value),
        }), {}));
    }
    /**
     * `when` callback
     *
     * @public
     * @decorator `@bind`
     */
    async when(_bud, options) {
        return (options &&
            !isUndefined(Object.keys(options)?.length) &&
            Object.keys(options).length > 0);
    }
};
__decorate([
    bind,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Bud]),
    __metadata("design:returntype", Promise)
], BudDefine.prototype, "init", null);
__decorate([
    bind,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Bud, Object]),
    __metadata("design:returntype", Promise)
], BudDefine.prototype, "when", null);
BudDefine = __decorate([
    label(`@roots/bud-extensions/webpack-define-plugin`),
    plugin(Webpack.DefinePlugin)
], BudDefine);
export default BudDefine;
//# sourceMappingURL=index.js.map