import { __decorate, __metadata } from "tslib";
import { Extension } from '@roots/bud-framework/extension';
import { bind, dependsOn, expose, label, } from '@roots/bud-framework/extension/decorators';
/**
 * roots/sage support extension
 *
 * @see https://bud.js.org/extensions/sage/
 */
let Sage = class Sage extends Extension {
    /**
     * `register` callback
     */
    async register(bud) {
        bud.hooks.on(`build.output.uniqueName`, `@roots/bud/sage/${bud.label}`);
        /* Set paths */
        bud.setPath({
            '@src': `resources`,
            '@resources': `@src`,
            '@fonts': `@src/fonts`,
            '@images': `@src/images`,
            '@scripts': `@src/scripts`,
            '@styles': `@src/styles`,
            '@views': `@src/views`,
            '@dist': `public`,
            '@public': `@dist`,
        });
        /* Set aliases */
        bud.alias({
            '@fonts': bud.path(`@fonts`),
            '@images': bud.path(`@images`),
            '@scripts': bud.path(`@scripts`),
            '@styles': bud.path(`@styles`),
            '@views': bud.path(`@views`),
        });
        /* Set runtime single */
        bud.runtime(`single`);
        /**
         * Optimize
         */
        bud.when(bud.isProduction, () => bud.minimize().hash().splitChunks(), () => bud.devtool());
    }
    /**
     * Set acorn version
     *
     * @deprecated - This function is deprecated. It is unneeded; you can just remove the call.
     */
    setAcornVersion(version) {
        /* istanbul ignore next -- @preserve */
        this.logger.warn(`\n\n`, `bud.sage.setAcornVersion: This function is deprecated.\n It is unneeded; you can just remove the call.\n\n`, `If you feel that you need to run it you can add the following to your config:\n\n`, `bud.use(\`@roots/sage/acorn-v2-public-path\`)\n\n`, `If you are experiencing an issue and adding this extension fixes it, please open an issue.\n\n`, `https://github.com/roots/bud.\n\n`);
    }
};
__decorate([
    bind,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [Function]),
    __metadata("design:returntype", Promise)
], Sage.prototype, "register", null);
__decorate([
    bind
    /* istanbul ignore next -- @preserve */
    ,
    __metadata("design:type", Function),
    __metadata("design:paramtypes", [String]),
    __metadata("design:returntype", void 0)
], Sage.prototype, "setAcornVersion", null);
Sage = __decorate([
    label(`@roots/sage`),
    dependsOn([
        `@roots/bud-preset-wordpress`,
        `@roots/sage/acorn`,
        `@roots/sage/blade-loader`,
    ]),
    expose(`sage`)
], Sage);
export { Sage };
//# sourceMappingURL=extension.js.map